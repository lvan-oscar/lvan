name: Fixed CUDA Test
on: [push]

jobs:
  cuda-test:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    container:
      image: registry.cn-hangzhou.aliyuncs.com/paddlepaddle/paddle:latest-cuda12.1.1
      options: --shm-size=1g --pull-timeout 600
      
    steps:
    - name: 下载代码
      uses: actions/checkout@v4
      
    - name: 验证路径
      run: echo "当前路径: $PWD, 内容: $(ls)"
      
    - name: 安装依赖
      run: |
        pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
        pip install torch==2.1.0 torchaudio librosa numpy
        
    - name: 运行测试
      run: |
        echo "===== CUDA设备检测 ====="
        python -c "import torch; print(f'CUDA可用: {torch.cuda.is_available()}')"
        python -c "import torch; print(f'设备名称: {torch.cuda.get_device_name(0)}')"
        
        echo "===== 运行自定义测试 ====="
        python gpu_test.py
